#!/usr/bin/env python

from waflib import TaskGen
TaskGen.task_gen.mappings['.m'] = TaskGen.task_gen.mappings['.c']

import os
UNAME = os.uname()[0]

glfw_files = ["enable.c",
              "fullscreen.c",
              "glext.c",
              "image.c",
              "init.c",
              "input.c",
              "joystick.c",
              "stream.c",
              "tga.c",
              "thread.c",
              "time.c",
              "window.c"]

if UNAME == "Darwin":
  glfw_files.extend(["cocoa/cocoa_enable.m",
                     "cocoa/cocoa_fullscreen.m",
                     "cocoa/cocoa_glext.m",
                     "cocoa/cocoa_init.m",
                     "cocoa/cocoa_joystick.m",
                     "cocoa/cocoa_thread.c",
                     "cocoa/cocoa_time.m",
                     "cocoa/cocoa_window.m"])
elif UNAME.startswith("CYGWIN"):
  glfw_files.extend(["win32/win32_dllmain.c",
                     "win32/win32_enable.c",
                     "win32/win32_fullscreen.c",
                     "win32/win32_glext.c",
                     "win32/win32_init.c",
                     "win32/win32_joystick.c",
                     "win32/win32_thread.c",
                     "win32/win32_time.c",
                     "win32/win32_window.c"])
else:
  glfw_files.extend(["x11/x11_enable.c",
                     "x11/x11_fullscreen.c",
                     "x11/x11_glext.c",
                     "x11/x11_init.c",
                     "x11/x11_joystick.c",
                     "x11/x11_keysym2unicode.c",
                     "x11/x11_thread.c",
                     "x11/x11_time.c",
                     "x11/x11_window.c"])

def build(bld):
  lib = bld.stlib(source = " ".join(glfw_files),
                  target = "glfw",
                  name = "glfw",
                  version = "1.0",
                  cflags = ['-c',
                            '-I../external/glfw',
                            '-O2',
                            '-w',
                            '-fno-common',
                            '-g'],
                  use = "SOIL")

  if UNAME == "Darwin":
    lib.cflags.append("-I../external/glfw/cocoa")
  elif UNAME.startswith("CYGWIN"):
	lib.cflags.append("-I../external/glfw/win32")
	lib.uselib = 'GL GLU OPENGL32'
  else:
    lib.cflags.append("-I../external/glfw/x11")
    lib.uselib = 'GL GLU'
